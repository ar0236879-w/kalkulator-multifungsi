<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prisma Calculator - Colorful Edition</title>
    <!-- Font Futuristik -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        :root {
            /* Palet Warna Pelangi */
            --color-1: #ff0055; /* Hot Pink */
            --color-2: #ffaa00; /* Orange */
            --color-3: #ccff00; /* Lime */
            --color-4: #00ffcc; /* Cyan */
            --color-5: #aa00ff; /* Purple */
            
            --bg-dark: #0a0014; /* Deep Violet Black */
            --glass: rgba(20, 10, 40, 0.6);
            --text-main: #ffffff;
            --text-dim: #d0d0d0;
            --error: #ff3333;
            --success: #00ff66;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            outline: none;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-dark);
            background: radial-gradient(circle at center, #1a0033 0%, #000000 100%);
            color: var(--text-main);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Canvas 3D Background */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* UI Container */
        .app-container {
            width: 92%;
            max-width: 1250px;
            height: 88vh;
            /* Glassmorphism Colorful */
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.05), rgba(0, 255, 204, 0.05), rgba(170, 0, 255, 0.05));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            box-shadow: 
                0 0 40px rgba(170, 0, 255, 0.2),
                inset 0 0 20px rgba(0, 255, 204, 0.05);
            display: grid;
            grid-template-columns: 260px 1fr 260px;
            overflow: hidden;
            animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9) rotateX(10deg); }
            to { opacity: 1; transform: scale(1) rotateX(0deg); }
        }

        /* Sidebar Navigasi */
        .sidebar {
            padding: 25px;
            border-right: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0) 100%);
        }

        .brand {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            font-weight: 900;
            /* Text Gradient Rainbow */
            background: linear-gradient(90deg, var(--color-1), var(--color-4));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 25px;
            text-align: center;
            letter-spacing: 1px;
            text-shadow: 0 0 20px rgba(255,0,85,0.5);
        }

        .nav-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            color: var(--text-dim);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            position: relative;
            overflow: hidden;
        }

        /* Efek Hover Colorful */
        .nav-btn:hover {
            background: linear-gradient(90deg, rgba(255, 0, 85, 0.2), rgba(170, 0, 255, 0.2));
            border-color: var(--color-5);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(170, 0, 255, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(90deg, var(--color-4), var(--color-5));
            border: none;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
        }

        /* Area Utama */
        .main-content {
            padding: 35px;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .category-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, var(--color-2), var(--color-3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 170, 0, 0.3);
        }

        .tool-select {
            width: 100%;
            padding: 15px;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            border-radius: 12px;
            margin-bottom: 30px;
            font-family: 'Roboto', sans-serif;
            font-size: 1rem;
            transition: 0.3s;
        }

        .tool-select:focus {
            border-color: var(--color-3);
            box-shadow: 0 0 15px rgba(204, 255, 0, 0.2);
        }

        /* Inputs */
        .calc-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        label {
            color: var(--color-4);
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, select {
            background: rgba(255,255,255,0.07);
            border: 2px solid transparent;
            padding: 15px;
            color: white;
            border-radius: 10px;
            font-size: 1rem;
            transition: 0.3s;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        input:focus, select:focus {
            background: rgba(255,255,255,0.1);
            /* Border Gradient using pseudo-element is complex, simple solid color fallback */
            border-color: var(--color-1);
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
        }

        /* Tombol Aksi Utama */
        .action-btn {
            background: linear-gradient(45deg, var(--color-1), var(--color-5), var(--color-4), var(--color-2));
            background-size: 300% 300%;
            border: none;
            color: white;
            padding: 18px;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.1rem;
            animation: gradientMove 3s ease infinite;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .action-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(204, 255, 0, 0.5);
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Result Box */
        .result-box {
            margin-top: 25px;
            padding: 25px;
            background: rgba(0,0,0,0.5);
            border-left: 5px solid var(--color-3);
            border-radius: 0 15px 15px 0;
            min-height: 100px;
            position: relative;
            overflow: hidden;
        }

        .result-box::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(204, 255, 0, 0.1), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .result-title {
            color: var(--color-2);
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.8rem;
            color: var(--color-4);
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
            z-index: 1;
            position: relative;
        }

        .formula-display {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-dim);
            font-family: 'Roboto', sans-serif;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Sidebar History */
        .history-panel {
            padding: 20px;
            border-left: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            background: linear-gradient(0deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0) 100%);
        }

        .history-panel h3 {
            font-family: 'Orbitron';
            background: linear-gradient(to bottom, var(--color-1), var(--color-5));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .history-list {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            border-left: 3px solid var(--color-4);
            cursor: pointer;
            transition: 0.2s;
        }

        .history-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: var(--color-2);
        }

        .history-item span {
            display: block;
            color: var(--text-dim);
            font-size: 0.7rem;
            margin-top: 3px;
        }

        .clear-history {
            margin-top: 15px;
            padding: 10px;
            background: transparent;
            border: 1px solid var(--color-1);
            color: var(--color-1);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: 0.3s;
        }

        .clear-history:hover {
            background: var(--color-1);
            color: white;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.5);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: linear-gradient(var(--color-5), var(--color-1)); border-radius: 3px; }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .toast {
            background: rgba(20, 10, 40, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-top: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            border-left: 5px solid var(--color-4);
            animation: toastSlide 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 320px;
        }

        .toast.error { border-color: var(--error); }
        .toast.success { border-color: var(--color-3); }

        @keyframes toastSlide {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: 100vh;
                width: 100%;
                border-radius: 0;
            }
            .sidebar {
                flex-direction: row;
                overflow-x: auto;
                padding: 15px;
                border-right: none;
                border-bottom: 1px solid rgba(255,255,255,0.05);
            }
            .brand { display: none; }
            .nav-btn { min-width: 130px; text-align: center; font-size: 0.75rem; padding: 10px;}
            .history-panel { display: none; }
            .main-content { padding: 20px; }
            .category-title { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <!-- 3D Background (Colorful Particles) -->
    <div id="canvas-container"></div>

    <!-- Main Application -->
    <div class="app-container">
        
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="brand">PRISMA<br>CALC</div>
            <button class="nav-btn active" onclick="setCategory('math')">Matematika</button>
            <button class="nav-btn" onclick="setCategory('physics')">Fisika</button>
            <button class="nav-btn" onclick="setCategory('chem')">Kimia</button>
            <button class="nav-btn" onclick="setCategory('bio')">Biologi</button>
            <button class="nav-btn" onclick="setCategory('temp')">Suhu</button>
        </nav>

        <!-- Content Area -->
        <main class="main-content">
            <h2 class="category-title" id="cat-title">MATEMATIKA</h2>
            
            <select id="tool-selector" class="tool-select" onchange="loadTool()">
                <!-- Options populated by JS -->
            </select>

            <div id="dynamic-form" class="calc-area">
                <!-- Inputs injected here -->
            </div>

            <button class="action-btn" onclick="calculate()">HITUNG SEKARANG</button>

            <div class="result-box">
                <div class="result-title">Hasil Perhitungan</div>
                <div class="result-value" id="result-display">--</div>
                <div class="formula-display" id="formula-display"></div>
            </div>
        </main>

        <!-- History Panel -->
        <aside class="history-panel">
            <h3>RIWAYAT</h3>
            <div class="history-list" id="history-list">
                <div style="text-align:center; color: var(--text-dim); margin-top:20px; font-size:0.8rem; opacity:0.5;">Belum ada data</div>
            </div>
            <button class="clear-history" onclick="clearHistory()">Hapus Riwayat</button>
        </aside>

    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        /* ----------------------------------------------------------------
           1. DATA & KONFIGURASI KALKULATOR (LOGIC TETAP SAMA)
        ---------------------------------------------------------------- */
        
        const tools = {
            math: {
                name: "Matematika",
                options: {
                    basic: { name: "Operasi Dasar", inputs: ["Angka 1", "Angka 2", "Operasi"], types: ["number", "number", "select"] },
                    power: { name: "Pangkat & Akar", inputs: ["Basis", "Eksponen"], types: ["number", "number"] },
                    trig: { name: "Trigonometri", inputs: ["Sudut (Derajat)", "Fungsi"], types: ["number", "select"] },
                    quad: { name: "Persamaan Kuadrat (ax²+bx+c=0)", inputs: ["a", "b", "c"], types: ["number", "number", "number"] },
                    matrix_det: { name: "Determinan Matriks 2x2", inputs: ["a", "b", "c", "d"], types: ["number", "number", "number", "number"] }
                }
            },
            physics: {
                name: "Fisika",
                options: {
                    velocity: { name: "Kecepatan Rata-rata", inputs: ["Jarak (m)", "Waktu (s)"], types: ["number", "number"] },
                    newton2: { name: "Hukum II Newton (F=ma)", inputs: ["Massa (kg)", "Percepatan (m/s²)"], types: ["number", "number"] },
                    energy: { name: "Energi Kinetik (Ek=½mv²)", inputs: ["Massa (kg)", "Kecepatan (m/s)"], types: ["number", "number"] },
                    heat: { name: "Kalor (Q=mcΔT)", inputs: ["Massa (g)", "Kalor Jenis (J/g°C)", "Perubahan Suhu (°C)"], types: ["number", "number", "number"] }
                }
            },
            chem: {
                name: "Kimia",
                options: {
                    mol: { name: "Mol (n = m/M)", inputs: ["Massa (gram)", "Massa Molar (g/mol)"], types: ["number", "number"] },
                    concentration: { name: "Molaritas (M = n/V)", inputs: ["Mol (mol)", "Volume (L)"], types: ["number", "number"] }
                }
            },
            bio: {
                name: "Biologi",
                options: {
                    growth: { name: "Pertumbuhan Populasi", inputs: ["Populasi Awal", "Waktu", "Laju Pertumbuhan (%)"], types: ["number", "number", "number"] }
                }
            },
            temp: {
                name: "Suhu",
                options: {
                    converter: { name: "Konversi Suhu Lengkap", inputs: ["Nilai", "Dari", "Ke"], types: ["number", "select", "select"] }
                }
            }
        };

        const specialOptions = {
            "Operasi": ["+", "-", "*", "/"],
            "Fungsi": ["sin", "cos", "tan"],
            "Dari": ["Celsius (°C)", "Fahrenheit (°F)", "Kelvin (K)", "Reamur (°R)"],
            "Ke": ["Celsius (°C)", "Fahrenheit (°F)", "Kelvin (K)", "Reamur (°R)"]
        };

        let currentCategory = 'math';
        let currentTool = 'basic';
        let historyData = [];

        /* ----------------------------------------------------------------
           2. MANAJEMEN UI
        ---------------------------------------------------------------- */

        function init() {
            setCategory('math');
            initThreeJS();
        }

        function setCategory(cat) {
            currentCategory = cat;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('cat-title').innerText = tools[cat].name.toUpperCase();
            
            // Populate dropdown
            const selector = document.getElementById('tool-selector');
            selector.innerHTML = '';
            const options = tools[cat].options;
            
            for (const [key, val] of Object.entries(options)) {
                const option = document.createElement('option');
                option.value = key;
                option.innerText = val.name;
                selector.appendChild(option);
            }
            
            loadTool();
        }

        function loadTool() {
            currentTool = document.getElementById('tool-selector').value;
            const toolData = tools[currentCategory].options[currentTool];
            const container = document.getElementById('dynamic-form');
            
            container.innerHTML = ''; // Clear previous inputs
            
            toolData.inputs.forEach((labelText, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'input-group';
                
                const label = document.createElement('label');
                label.innerText = labelText;
                
                let input;
                
                if (toolData.types[index] === 'select') {
                    input = document.createElement('select');
                    input.id = `input-${index}`;
                    const opts = specialOptions[labelText] || [];
                    if(opts.length > 0) {
                        opts.forEach(o => {
                            const optEl = document.createElement('option');
                            optEl.value = o;
                            optEl.innerText = o;
                            input.appendChild(optEl);
                        });
                    }
                } else {
                    input = document.createElement('input');
                    input.type = 'number';
                    input.placeholder = 'Masukkan nilai...';
                    input.id = `input-${index}`;
                    input.step = 'any';
                }

                wrapper.appendChild(label);
                wrapper.appendChild(input);
                container.appendChild(wrapper);
            });

            document.getElementById('result-display').innerText = '--';
            document.getElementById('formula-display').innerText = '';
        }

        /* ----------------------------------------------------------------
           3. LOGIKA PERHITUNGAN
        ---------------------------------------------------------------- */

        function calculate() {
            try {
                const toolData = tools[currentCategory].options[currentTool];
                const inputs = [];
                
                for (let i = 0; i < toolData.inputs.length; i++) {
                    const el = document.getElementById(`input-${i}`);
                    const val = el.value;
                    if (val === '') throw new Error("Input tidak boleh kosong");
                    inputs.push(isNaN(val) ? val : parseFloat(val));
                }

                let result = 0;
                let formula = "";
                let resultText = "";

                if (currentCategory === 'math') {
                    switch (currentTool) {
                        case 'basic':
                            const n1 = inputs[0], n2 = inputs[1], op = inputs[2];
                            if (op === '/' && n2 === 0) throw new Error("Tidak bisa bagi 0");
                            if (op === '+') result = n1 + n2;
                            if (op === '-') result = n1 - n2;
                            if (op === '*') result = n1 * n2;
                            if (op === '/') result = n1 / n2;
                            formula = `${n1} ${op} ${n2}`;
                            break;
                        case 'power':
                            result = Math.pow(inputs[0], inputs[1]);
                            formula = `${inputs[0]} ^ ${inputs[1]}`;
                            break;
                        case 'trig':
                            const rad = inputs[0] * (Math.PI / 180);
                            if (inputs[1] === 'sin') result = Math.sin(rad);
                            if (inputs[1] === 'cos') result = Math.cos(rad);
                            if (inputs[1] === 'tan') result = Math.tan(rad);
                            formula = `${inputs[1]}(${inputs[0]}°)`;
                            break;
                        case 'quad':
                            const a = inputs[0], b = inputs[1], c = inputs[2];
                            const D = (b*b) - (4*a*c);
                            if (D < 0) {
                                resultText = "Akar Imajiner";
                                formula = `D = ${D} (D < 0)`;
                            } else {
                                const x1 = (-b + Math.sqrt(D)) / (2*a);
                                const x2 = (-b - Math.sqrt(D)) / (2*a);
                                resultText = `x₁ = ${x1.toFixed(4)}, x₂ = ${x2.toFixed(4)}`;
                                formula = `x = (-b ± √D) / 2a`;
                            }
                            break;
                        case 'matrix_det':
                            result = (inputs[0]*inputs[3]) - (inputs[1]*inputs[2]);
                            formula = `(${inputs[0]}·${inputs[3]}) - (${inputs[1]}·${inputs[2]})`;
                            break;
                    }
                }
                else if (currentCategory === 'physics') {
                    switch (currentTool) {
                        case 'velocity':
                            if (inputs[1] === 0) throw new Error("Waktu tidak boleh 0");
                            result = inputs[0] / inputs[1];
                            formula = "v = s / t";
                            break;
                        case 'newton2':
                            result = inputs[0] * inputs[1];
                            formula = "F = m × a";
                            break;
                        case 'energy':
                            result = 0.5 * inputs[0] * Math.pow(inputs[1], 2);
                            formula = "Ek = ½mv²";
                            break;
                        case 'heat':
                            result = inputs[0] * inputs[1] * inputs[2];
                            formula = "Q = m × c × ΔT";
                            break;
                    }
                }
                else if (currentCategory === 'chem') {
                    switch (currentTool) {
                        case 'mol':
                            if (inputs[1] === 0) throw new Error("Massa molar tidak boleh 0");
                            result = inputs[0] / inputs[1];
                            formula = "n = m / M";
                            break;
                        case 'concentration':
                            if (inputs[1] === 0) throw new Error("Volume tidak boleh 0");
                            result = inputs[0] / inputs[1];
                            formula = "M = n / V";
                            break;
                    }
                }
                else if (currentCategory === 'bio') {
                    if (currentTool === 'growth') {
                        const P0 = inputs[0];
                        const t = inputs[1];
                        const r = inputs[2] / 100;
                        result = P0 * Math.exp(r * t);
                        formula = "P = P₀ × e^(rt)";
                    }
                }
                else if (currentCategory === 'temp') {
                    const val = inputs[0];
                    const from = inputs[1].split(' ')[0];
                    const to = inputs[2].split(' ')[0];

                    if (from === 'Kelvin' && val < 0) throw new Error("Suhu tidak boleh di bawah 0 Kelvin");

                    let tempInC = 0;

                    if (from === 'Celsius') tempInC = val;
                    if (from === 'Fahrenheit') tempInC = (val - 32) * 5/9;
                    if (from === 'Kelvin') tempInC = val - 273.15;
                    if (from === 'Reamur') tempInC = val * 5/4;

                    if (tempInC < -273.15) throw new Error("Hasil di bawah 0 Kelvin (Tidak Valid)");

                    if (to === 'Celsius') result = tempInC;
                    if (to === 'Fahrenheit') result = (tempInC * 9/5) + 32;
                    if (to === 'Kelvin') result = tempInC + 273.15;
                    if (to === 'Reamur') result = tempInC * 4/5;

                    formula = `Konversi ${from} ke ${to}`;
                    resultText = result.toFixed(2) + "°";
                    if (to === 'Kelvin') resultText = result.toFixed(2) + " K";
                }

                if (resultText === "") {
                    if (typeof result === 'number' && !Number.isInteger(result)) {
                        result = result.toFixed(4);
                    }
                    resultText = result;
                    if (currentCategory === 'physics' || currentCategory === 'chem' || currentCategory === 'bio') {
                        resultText += " (hasil satuan terkait)";
                    }
                }

                document.getElementById('result-display').innerText = resultText;
                document.getElementById('formula-display').innerText = formula;
                addToHistory(toolData.name, resultText);

            } catch (err) {
                showToast(err.message, 'error');
                document.getElementById('result-display').innerText = "ERROR";
            }
        }

        /* ----------------------------------------------------------------
           4. FITUR RIWAYAT & NOTIFIKASI
        ---------------------------------------------------------------- */
        function addToHistory(toolName, resultVal) {
            const historyItem = { tool: toolName, val: resultVal, time: new Date().toLocaleTimeString() };
            historyData.unshift(historyItem);
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            
            historyData.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'history-item';
                el.innerHTML = `
                    <div>${item.tool}</div>
                    <strong>${item.val}</strong>
                    <span>${item.time}</span>
                `;
                list.appendChild(el);
            });
        }

        function clearHistory() {
            historyData = [];
            renderHistory();
            showToast("Riwayat dihapus", "success");
        }

        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerText = msg;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        /* ----------------------------------------------------------------
           5. THREE.JS COLORFUL BACKGROUND
        ---------------------------------------------------------------- */
        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            // Dark fog to blend particles
            scene.fog = new THREE.FogExp2(0x0a0014, 0.002);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // 1. Geometri Utama (Icosahedron Pelangi)
            const geometry = new THREE.IcosahedronGeometry(10, 2);
            
            // Menggunakan Vertex Colors untuk membuat warna pelangi per titik
            const count = geometry.attributes.position.count;
            geometry.setAttribute('color', new THREE.BufferAttribute(new Float32Array(count * 3), 3));

            const colors = geometry.attributes.color;
            const colorPalette = [
                new THREE.Color(0xff0055), // Pink
                new THREE.Color(0xffaa00), // Orange
                new THREE.Color(0xccff00), // Lime
                new THREE.Color(0x00ffcc), // Cyan
                new THREE.Color(0xaa00ff)  // Purple
            ];

            for (let i = 0; i < count; i++) {
                const randomColor = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                colors.setXYZ(i, randomColor.r, randomColor.g, randomColor.b);
            }

            const material = new THREE.MeshBasicMaterial({ 
                vertexColors: true, // Gunakan warna vertex
                wireframe: true,
                transparent: true,
                opacity: 0.3
            });
            const sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);

            // 2. Partikel Sekunder (Debu Bintang Berwarna)
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 600;
            const posArray = new Float32Array(particlesCount * 3);
            const colorArray = new Float32Array(particlesCount * 3);

            for(let i = 0; i < particlesCount * 3; i+=3) {
                posArray[i] = (Math.random() - 0.5) * 50;     // x
                posArray[i+1] = (Math.random() - 0.5) * 50;   // y
                posArray[i+2] = (Math.random() - 0.5) * 50;   // z

                // Warna random untuk partikel juga
                const randomColor = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                colorArray[i] = randomColor.r;
                colorArray[i+1] = randomColor.g;
                colorArray[i+2] = randomColor.b;
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorArray, 3));

            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.1,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);

            camera.position.z = 25;

            // Mouse Interaction
            let mouseX = 0;
            let mouseY = 0;
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX - window.innerWidth / 2) * 0.005;
                mouseY = (event.clientY - window.innerHeight / 2) * 0.005;
            });

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // Animation Loop
            const clock = new THREE.Clock();

            function animate() {
                requestAnimationFrame(animate);
                const elapsedTime = clock.getElapsedTime();

                sphere.rotation.y += 0.002;
                sphere.rotation.x += 0.001;

                // Partikel bergerak seperti gelombang
                particlesMesh.rotation.y = -elapsedTime * 0.05;
                
                // Responsif mouse (smooth damping)
                sphere.rotation.y += 0.05 * (mouseX - sphere.rotation.y);
                sphere.rotation.x += 0.05 * (mouseY - sphere.rotation.x);

                // Efek Pulsasi (Bernapas) pada Sphere
                const scale = 1 + Math.sin(elapsedTime * 1.5) * 0.1;
                sphere.scale.set(scale, scale, scale);

                renderer.render(scene, camera);
            }

            animate();
        }

        // Start App
        window.onload = init;
    </script>
</body>
</html>